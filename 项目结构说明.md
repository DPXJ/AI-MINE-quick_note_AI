# QuickNote AI - 项目结构说明

## 📁 目录结构

```
02-同步flomo/
├── src/                        # 源代码目录
│   ├── __init__.py
│   ├── main.py                 # 主程序入口
│   │
│   ├── core/                   # 核心功能模块
│   │   ├── __init__.py
│   │   ├── hotkey.py          # 全局快捷键监听
│   │   ├── clipboard.py       # 剪切板监控
│   │   └── ai_processor.py    # AI内容处理
│   │
│   ├── gui/                    # 图形界面模块
│   │   ├── __init__.py
│   │   ├── quick_input.py     # 快速输入窗口
│   │   ├── tray_icon.py       # 系统托盘图标
│   │   └── settings.py        # 设置界面
│   │
│   ├── integrations/           # 第三方集成模块
│   │   ├── __init__.py
│   │   ├── notion_api.py      # Notion API封装
│   │   └── flomo_api.py       # Flomo API封装
│   │
│   └── utils/                  # 工具模块
│       ├── __init__.py
│       └── config.py          # 配置管理
│
├── logs/                       # 日志文件目录
│   └── .gitkeep
│
├── config.yaml                 # 应用配置文件
├── .env                        # 环境变量（需自行创建）
├── .env.template              # 环境变量模板
├── requirements.txt            # Python依赖
├── build.spec                 # PyInstaller打包配置
│
├── run.bat                    # 运行脚本（Windows）
├── build.bat                  # 打包脚本（Windows）
│
├── README.md                  # 项目说明
├── INSTALL.md                 # 安装指南
├── 快速开始.txt               # 快速开始指南
├── 项目结构说明.md            # 本文件
│
└── .gitignore                 # Git忽略文件
```

## 📦 核心模块说明

### 1. main.py - 主程序
**功能**：
- 应用程序入口
- 初始化所有组件
- 连接信号和槽
- 处理业务逻辑

**关键类**：
- `QuickNoteApp`：主应用程序类

### 2. core/ - 核心功能

#### hotkey.py - 快捷键监听
**功能**：
- 监听全局快捷键
- 支持组合键（Ctrl、Shift、Alt等）
- 触发回调函数

**关键类**：
- `HotkeyListener`：快捷键监听器

#### clipboard.py - 剪切板监控
**功能**：
- 监控系统剪切板变化
- 内容验证和过滤
- 支持启动/停止

**关键类**：
- `ClipboardMonitor`：剪切板监控器

#### ai_processor.py - AI处理
**功能**：
- 调用AI模型（OpenAI/Claude）
- 内容分类和识别
- 智能分流规则

**关键类**：
- `AIProcessor`：AI处理器

### 3. gui/ - 图形界面

#### quick_input.py - 快速输入窗口
**功能**：
- 极简输入界面
- 快捷键操作（Enter、Esc）
- 自动居中显示

**关键类**：
- `QuickInputWindow`：快速输入窗口

#### tray_icon.py - 系统托盘
**功能**：
- 系统托盘图标
- 右键菜单
- 消息通知

**关键类**：
- `TrayIcon`：托盘图标

#### settings.py - 设置界面
**功能**：
- 配置API密钥
- 查看AI规则
- 测试连接

**关键类**：
- `SettingsDialog`：设置对话框

### 4. integrations/ - 第三方集成

#### notion_api.py - Notion集成
**功能**：
- 添加灵感到Database
- 支持标题、优先级、标签
- 连接测试

**关键类**：
- `NotionAPI`：Notion API封装

#### flomo_api.py - Flomo集成
**功能**：
- 添加Memo
- 支持标签
- Webhook调用

**关键类**：
- `FlomoAPI`：Flomo API封装

### 5. utils/ - 工具

#### config.py - 配置管理
**功能**：
- 加载YAML配置
- 读取环境变量
- 配置验证

**关键类**：
- `Config`：配置管理类

## 🔄 数据流程

### 快速输入流程
```
用户按快捷键
    ↓
HotkeyListener 触发
    ↓
显示 QuickInputWindow
    ↓
用户输入内容
    ↓
提交到 NotionAPI
    ↓
显示成功通知
```

### 剪切板监控流程
```
用户复制内容
    ↓
ClipboardMonitor 检测
    ↓
内容验证
    ↓
AIProcessor 分析
    ↓
分类决策
    ↓
┌─────┴─────┐
↓           ↓
NotionAPI   FlomoAPI
↓           ↓
显示通知    显示通知
```

## ⚙️ 配置文件

### config.yaml
- 应用配置
- 快捷键设置
- AI识别规则
- UI主题配置

### .env
- API密钥
- 敏感信息
- **不要提交到Git**

## 🔧 技术栈

| 技术 | 用途 | 版本 |
|------|------|------|
| Python | 主语言 | 3.10+ |
| PyQt5 | GUI框架 | 5.15+ |
| pynput | 快捷键监听 | 1.7+ |
| pyperclip | 剪切板操作 | 1.8+ |
| notion-client | Notion API | 2.2+ |
| openai | OpenAI API | 1.6+ |
| anthropic | Claude API | 0.8+ |
| PyInstaller | 打包工具 | 6.3+ |

## 📝 代码规范

### 命名规范
- 类名：大驼峰（PascalCase）
- 函数/变量：小写+下划线（snake_case）
- 常量：全大写+下划线（UPPER_CASE）
- 私有方法：下划线开头（_method）

### 文档规范
- 所有类和公共方法需要有文档字符串
- 使用Google风格的docstring
- 复杂逻辑添加注释

### 日志规范
- 使用loguru记录日志
- 日志级别：DEBUG、INFO、WARNING、ERROR
- 关键操作需记录日志

## 🚀 扩展开发

### 添加新的笔记工具
1. 在 `src/integrations/` 创建新的API文件
2. 实现API封装类
3. 在 `main.py` 中集成
4. 在 `config.yaml` 添加规则

### 自定义AI提示词
1. 编辑 `config.yaml` 中的 `ai_rules`
2. 修改 `prompt` 字段
3. 调整 `keywords` 列表

### 修改快捷键
1. 编辑 `config.yaml` 中的 `hotkeys`
2. 重启应用生效

### 自定义UI主题
1. 编辑 `config.yaml` 中的 `ui.theme`
2. 修改颜色代码
3. 重启应用生效

## 🐛 调试技巧

### 查看日志
```bash
# 实时查看日志
tail -f logs/quicknote_*.log
```

### 开启调试模式
```python
# 在 main.py 中修改
logger.add(..., level="DEBUG")
```

### 测试单个模块
```python
# 创建测试文件
python -c "from src.integrations.notion_api import NotionAPI; ..."
```

## 📊 性能优化

### 降低API调用成本
- 使用 `gpt-4o-mini` 而不是 `gpt-4`
- 调整剪切板检查间隔
- 优化提示词长度

### 提升响应速度
- 异步处理剪切板内容
- 缓存AI分析结果
- 优化正则表达式

## 🔐 安全建议

1. **不要**在代码中硬编码API密钥
2. **不要**将 `.env` 文件提交到Git
3. **定期**更换API密钥
4. **使用**环境变量存储敏感信息
5. **限制**API调用频率和配额

## 📮 贡献指南

如果你想贡献代码：
1. Fork本项目
2. 创建特性分支
3. 提交更改
4. 推送到分支
5. 创建Pull Request

---

更多问题请参考 README.md 或 INSTALL.md

