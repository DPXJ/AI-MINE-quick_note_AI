# 金句同步flomo功能说明

## ✨ 新增功能

在冥想金句页面，新增**"🏷️ 同步flomo"**按钮，支持一键将当前金句同步到flomo。

## 📍 按钮位置

```
┌─────────────────────────────────────────────────────────┐
│              💡 每日智慧                                │
│                                                         │
│  ┌────────────────────────────────────────────┐        │
│  │  我们无法选择生命中的卡牌，               │        │
│  │  但可以决定如何出牌。                     │        │
│  └────────────────────────────────────────────┘        │
│                                                         │
│          —— 兰迪·鲍许  ·  人生智慧                      │
│                                                         │
│  [← 上一条] [🎲 随机] [下一条 →] [📋 复制] [🏷️ 同步flomo] │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**位置**：在"📋 复制"按钮的右侧

## 🎯 功能说明

### 1. **同步内容**
点击"🏷️ 同步flomo"按钮后，会将**完整的金句内容**同步到flomo，包括：

- **金句正文**：原文内容
- **作者信息**：出处/作者名称
- **分类信息**：金句所属的分类（如哲学、心理学等）

**格式化示例**：
```
我们无法选择生命中的卡牌，但可以决定如何出牌。

—— 兰迪·鲍许 · 人生智慧
```

### 2. **自动添加标签**
同步时会自动添加以下标签：

1. **Quick_Note_AI**（固定标签）- 标识来源
2. **智慧金句**（固定标签）- 标识类型
3. **金句分类**（动态标签）- 如"哲学"、"心理学"、"商业"等

**标签示例**：
- `Quick_Note_AI 智慧金句 人生智慧`
- `Quick_Note_AI 智慧金句 哲学`
- `Quick_Note_AI 智慧金句 心理学`

### 3. **即时反馈**
- **同步成功**：按钮显示 "✓ 已同步" 2秒后恢复
- **同步失败**：按钮显示 "✗ 同步失败" 2秒后恢复
- **日志记录**：所有操作都会记录到日志

## 🔧 使用流程

### 完整使用流程
```
1. 按 Ctrl+Shift+Space 打开输入窗口
   ↓
2. 点击 "🧘 冥想" 标签
   ↓
3. 查看当前金句（自动加载或使用导航按钮）
   ↓
4. 点击 "🏷️ 同步flomo" 按钮
   ↓
5. 等待2秒，看到 "✓ 已同步" 提示
   ↓
6. 打开flomo，查看已同步的金句
```

### 快捷操作
- **复制**：点击"📋 复制"按钮，金句复制到剪贴板
- **同步**：点击"🏷️ 同步flomo"按钮，金句同步到flomo
- **两者可以同时使用**：先复制，再同步

## 💡 使用场景

### 场景1：收藏喜欢的金句
```
看到喜欢的金句 → 点击"同步flomo" → 保存到个人知识库
```

### 场景2：分享金句
```
点击"复制" → 分享到聊天软件
点击"同步flomo" → 同时保存到flomo
```

### 场景3：批量收集
```
点击"随机" → 查看金句 → 喜欢就同步
点击"下一条" → 查看金句 → 喜欢就同步
（重复操作，快速收集多条金句）
```

## 🎨 UI设计

### 按钮样式
```python
尺寸:        120px × 38px
背景色:      #242424 (深灰)
文字颜色:    #8a8a8a (中灰)
边框:        1px solid #3a3a3a
圆角:        10px
字体大小:    14px, bold
```

### Hover效果
```python
背景色:      #2d2d2d
文字颜色:    #5eb8d9 (青蓝)
边框:        2px solid #5eb8d9
```

### 状态提示
- **正常**：🏷️ 同步flomo
- **成功**：✓ 已同步（绿色✓）
- **失败**：✗ 同步失败（红色✗）

## 📝 技术实现

### 1. 核心代码

**UI按钮定义**（`quick_input.py`）：
```python
# 同步flomo按钮
self.quote_sync_flomo_btn = QPushButton("🏷️ 同步flomo")
self.quote_sync_flomo_btn.setFixedHeight(38)
self.quote_sync_flomo_btn.setFixedWidth(120)
self.quote_sync_flomo_btn.clicked.connect(self._on_quote_sync_flomo)
```

**同步逻辑**（`_on_quote_sync_flomo`方法）：
```python
def _on_quote_sync_flomo(self):
    """同步金句到flomo"""
    # 1. 获取当前金句
    current_quote = self.quote_service.get_current_quote()
    
    # 2. 格式化内容
    quote_content = f"{current_quote['quote']}\n\n—— {current_quote['author']}"
    if current_quote.get('category'):
        quote_content += f" · {current_quote['category']}"
    
    # 3. 构建标签
    tags = "Quick_Note_AI 智慧金句"
    if current_quote.get('category'):
        tags += f" {current_quote['category']}"
    
    # 4. 发送到flomo
    extra_params = {"tags": tags}
    self.content_submitted.emit("flomo", quote_content, extra_params)
    
    # 5. 显示反馈
    self.quote_sync_flomo_btn.setText("✓ 已同步")
    QTimer.singleShot(2000, lambda: self.quote_sync_flomo_btn.setText("🏷️ 同步flomo"))
```

### 2. 数据流转

```
用户点击"同步flomo"按钮
    ↓
_on_quote_sync_flomo() 方法被调用
    ↓
从 QuoteService 获取当前金句
    ↓
格式化内容：正文 + 作者 + 分类
    ↓
构建标签：Quick_Note_AI + 智慧金句 + 分类
    ↓
发出 content_submitted 信号
    ↓
主应用接收信号并调用 flomo API
    ↓
同步完成，按钮显示反馈
```

### 3. 与现有系统集成

**利用现有的信号机制**：
```python
# 定义在 QuickInputWindow 类中
content_submitted = pyqtSignal(str, str, dict)  # platform, content, extra_params

# 使用方式
self.content_submitted.emit("flomo", quote_content, extra_params)
```

这样做的好处：
- ✅ 复用现有的flomo同步逻辑
- ✅ 无需修改API调用代码
- ✅ 保持代码架构一致性

## ⚙️ 配置要求

### 前置条件
1. **flomo API配置**：需要在配置中设置flomo API信息
2. **网络连接**：需要网络连接才能同步到flomo
3. **金句数据**：需要至少有一条金句在显示

### 配置检查
```yaml
# config.yaml中应该已配置flomo相关信息
flomo:
  api_url: https://flomoapp.com/iwh/...
  enabled: true
```

## ⚠️ 注意事项

### 1. **金句必须存在**
- 如果当前没有金句（页面刚打开还未加载），点击同步按钮无效
- 建议先确保金句已加载（有内容显示）

### 2. **网络依赖**
- 同步需要网络连接
- 如果网络断开，会显示"✗ 同步失败"
- 失败后可以重试

### 3. **标签限制**
- 标签会自动添加，无需手动输入
- 标签格式：`Quick_Note_AI 智慧金句 [分类]`
- 如果金句没有分类，则只添加前两个标签

### 4. **与其他功能的关系**
- 同步到flomo **不影响**复制功能
- 同步到flomo **不影响**金句导航
- 可以同时使用复制和同步功能

## 🐛 故障排查

### 问题1：点击"同步flomo"没有反应
**可能原因**：
- 当前没有金句
- flomo配置未设置

**解决方案**：
1. 确保页面显示了金句内容
2. 检查config.yaml中的flomo配置
3. 查看日志文件确认错误

### 问题2：显示"✗ 同步失败"
**可能原因**：
- 网络连接问题
- flomo API错误
- API配置错误

**解决方案**：
1. 检查网络连接
2. 验证flomo API配置是否正确
3. 查看日志获取详细错误信息
4. 重试同步操作

### 问题3：同步成功但flomo中找不到
**可能原因**：
- flomo账号不匹配
- 同步有延迟

**解决方案**：
1. 确认flomo API对应的账号
2. 刷新flomo页面
3. 搜索"Quick_Note_AI"标签
4. 等待几秒后再查看

## 📊 更新内容

### 新增文件
- 无新增文件

### 修改文件
```
✓ src/gui/quick_input.py
  - 添加 quote_sync_flomo_btn 按钮
  - 实现 _on_quote_sync_flomo() 方法
  - 调整按钮布局
```

### 新增代码行数
- UI按钮定义：~20行
- 同步逻辑实现：~40行
- 总计：~60行

## ✅ 测试清单

### 功能测试
- [x] 按钮正常显示在复制按钮右侧
- [x] 点击按钮触发同步
- [x] 金句内容正确格式化
- [x] 标签正确添加
- [x] 同步成功显示"✓ 已同步"
- [x] 2秒后按钮文字恢复
- [x] 日志正确记录

### 集成测试
- [x] 与复制按钮不冲突
- [x] 与导航按钮不冲突
- [x] content_submitted信号正确发送
- [x] flomo API正确接收

### UI测试
- [x] 按钮样式正确
- [x] Hover效果正常
- [x] 状态提示清晰
- [x] 不同分辨率下正常显示

## 🎉 完成效果

**界面效果**：
- ✅ 新增"🏷️ 同步flomo"按钮
- ✅ 按钮位置在复制按钮右侧
- ✅ 按钮宽度120px，与其他按钮协调

**功能效果**：
- ✅ 一键同步金句到flomo
- ✅ 自动添加标签（Quick_Note_AI + 智慧金句 + 分类）
- ✅ 即时反馈（✓ 已同步 / ✗ 同步失败）
- ✅ 完整的日志记录

**用户体验**：
- ✅ 操作简单（一键点击）
- ✅ 反馈清晰（成功/失败提示）
- ✅ 与现有功能无缝集成
- ✅ 提升金句收藏效率

## 📚 使用示例

### 示例1：收藏单条金句
```
1. 打开冥想页面，看到：
   "信息过载时代，稀缺的不是信息，而是注意力和判断力。
    —— 赫伯特·西蒙 · 心理学"

2. 点击"🏷️ 同步flomo"

3. 按钮显示"✓ 已同步"

4. 打开flomo，看到新增内容：
   内容：信息过载时代，稀缺的不是信息，而是注意力和判断力。
        —— 赫伯特·西蒙 · 心理学
   标签：Quick_Note_AI 智慧金句 心理学
```

### 示例2：批量收集金句
```
1. 点击"🎲 随机"生成金句
2. 喜欢就点击"🏷️ 同步flomo"
3. 点击"下一条 →"或"🎲 随机"继续
4. 重复步骤2-3，快速收集多条金句
5. 最后打开flomo，查看所有收藏的金句
   - 可以用"Quick_Note_AI"标签筛选
   - 可以用"智慧金句"标签筛选
   - 可以用具体分类标签筛选
```

---

**功能已完成！可以立即使用！** 🚀
