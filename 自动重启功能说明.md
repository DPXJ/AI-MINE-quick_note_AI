# 定时自动重启功能说明

## 功能概述

为了解决程序长时间运行（超过10小时）后出现的闪屏问题，新增了**定时自动重启功能**。程序会每隔指定时间自动重启一次，确保稳定运行。

## 功能特点

- ✅ **自动重启**：无需手动操作，程序自动在后台重启
- ✅ **无感重启**：重启过程平滑，不影响使用体验
- ✅ **可配置**：可通过配置文件自定义重启间隔
- ✅ **重启提示**：重启前会显示托盘通知，告知用户

## 默认设置

- **默认重启间隔**：每 **4 小时** 自动重启一次
- **重启方式**：与手动重启相同，先启动新进程，再退出当前进程

## 配置方法

### 方法1：使用默认设置（推荐）

无需任何配置，程序启动后自动每4小时重启一次。

### 方法2：自定义重启间隔

在项目根目录的 `config.yaml` 文件中添加以下配置：

```yaml
# 自动重启间隔（单位：小时）
auto_restart_hours: 6   # 例如：设置为6小时重启一次
```

**配置说明**：
- `auto_restart_hours`: 重启间隔（小时），支持小数（如 `2.5` 表示2.5小时）
- 如果设置为 `0` 或负数，将使用默认值 4 小时
- 如果不配置此项，默认使用 4 小时

## 使用场景

### 适用情况

- ✅ 程序需要长时间运行（超过10小时）
- ✅ 出现闪屏、卡顿等性能问题
- ✅ 希望保持程序稳定运行

### 工作原理

1. 程序启动时，自动启动定时器
2. 定时器每4小时（或配置的时间）触发一次
3. 触发时显示托盘通知："程序将重启以保持稳定（每 X 小时）"
4. 自动执行重启流程：
   - 启动新的程序进程
   - 退出当前进程
   - 新进程接管所有功能

## 技术实现

- 使用 `QTimer` 实现定时功能
- 复用现有的 `_restart_app()` 方法，确保重启逻辑一致
- 支持开发模式和打包后的EXE模式

## 注意事项

1. **重启间隔建议**：
   - 建议设置为 4-8 小时
   - 间隔太短可能影响使用体验
   - 间隔太长可能无法及时解决闪屏问题

2. **重启时机**：
   - 重启会在后台自动进行
   - 重启前会显示通知，但不会等待用户确认
   - 重启过程中，新进程会立即启动，基本无感

3. **配置修改**：
   - 修改 `config.yaml` 后需要重启程序才能生效
   - 配置值必须是数字（支持小数）

## 日志记录

重启相关的日志会记录在 `logs/` 目录下，包括：
- 定时器启动日志
- 重启触发日志
- 重启执行日志

## 常见问题

### Q: 如何关闭自动重启功能？

A: 目前不支持完全关闭，但可以将 `auto_restart_hours` 设置为一个很大的值（如 `999`），这样基本不会触发重启。

### Q: 重启会丢失数据吗？

A: 不会。重启过程会先启动新进程，再退出旧进程，确保服务不中断。

### Q: 重启时正在输入的内容会丢失吗？

A: 如果正在使用快速输入窗口，建议先完成输入再重启。不过重启前会有通知，可以提前做好准备。

### Q: 如何查看下次重启时间？

A: 目前没有显示倒计时功能，但可以通过日志查看上次重启时间，推算下次重启时间。

## 更新日期

2026-02-03

## 相关文件

- `src/main.py` - 主程序，包含自动重启逻辑
- `config.yaml` - 配置文件，可自定义重启间隔

---

**享受更稳定的 QuickNote AI 体验！** 💡✨
