# 冥想金句功能说明

## ✨ 功能概述

在冥想标签页，不再显示输入框，而是展示**AI生成的智慧金句**，配合倒计时/正向计时功能，打造完整的冥想体验。

## 🎯 主要特性

### 1. **AI金句生成**
- 优先调用 SiliconFlow API (Qwen2.5-7B-Instruct) 生成深度金句
- API失败时使用8条精选备用金句
- 涵盖哲学、心理学、历史、商业、科技、人生智慧等领域

### 2. **金句导航**
- **上一条**：浏览历史金句（支持100条缓存）
- **下一条**：继续浏览或生成新金句
- **随机**：调用AI生成全新金句
- **复制**：一键复制金句及出处到剪贴板

### 3. **优雅展示**
- 居中大号字体显示金句内容
- 底部显示作者及分类信息
- 美观的边框和配色
- 与冥想计时器无缝切换

## 📋 界面布局

### 冥想金句界面
```
┌─────────────────────────────────────────────────┐
│  💡 快速输入灵感               已置顶  ─  ✕      │
├─────────────────────────────────────────────────┤
│  📝 Notion  🏷️ Flomo  ✅ 滴答清单  🧘 冥想     │
├─────────────────────────────────────────────────┤
│  倒计时: [45分钟] [15分钟] [10分钟] [自定义]      │
│           正向计时: [开始]                       │
│                                                 │
│              💡 每日智慧                         │
│                                                 │
│  ┌────────────────────────────────────────┐    │
│  │                                        │    │
│  │   信息过载时代，稀缺的不是信息，       │    │
│  │   而是注意力和判断力。                 │    │
│  │                                        │    │
│  └────────────────────────────────────────┘    │
│                                                 │
│          —— 赫伯特·西蒙  ·  心理学               │
│                                                 │
│    [← 上一条] [🎲 随机] [下一条 →] [📋 复制]    │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 计时器界面（点击倒计时/正向计时后）
```
┌─────────────────────────────────────────────────┐
│  💡 快速输入灵感               已置顶  ─  ✕      │
├─────────────────────────────────────────────────┤
│  📝 Notion  🏷️ Flomo  ✅ 滴答清单  🧘 冥想     │
├─────────────────────────────────────────────────┤
│                                                 │
│                  🧘 倒计时                      │
│                                                 │
│            ┌─────────────────┐                 │
│            │   00:14:54      │                 │
│            └─────────────────┘                 │
│                                                 │
│              [⏸ 暂停]  [⏹ 停止]               │
│                                                 │
└─────────────────────────────────────────────────┘
```

## 🔧 配置说明

### 1. API配置

在 `config.yaml` 中已添加金句配置：

```yaml
meditation_quotes:
  enabled: true
  api:
    base_url: https://api.siliconflow.cn/v1
    model: Qwen/Qwen2.5-7B-Instruct
  prompt: |
    你是一位智慧的导师，请生成一条能够启发思考、提升认知的金句。
    
    要求：
    1. 金句要有深度，能引发深层思考
    2. 涵盖领域：哲学、心理学、历史、商业、科技、人生智慧等
    3. 可以是名人名言，也可以是原创思考
    4. 必须包含明确的出处或归属
    5. 金句要简洁有力，一般不超过100字
    6. 避免鸡汤式的空洞表达，要有逻辑深度
    
    请以JSON格式返回：
    {
      "quote": "金句内容",
      "author": "作者或出处",
      "category": "分类（如：哲学、商业、心理学等）"
    }
```

### 2. 环境变量配置

**设置 SiliconFlow API Key**：

```bash
# Windows PowerShell (临时)
$env:SILICON_API_KEY="your_api_key_here"

# Windows PowerShell (永久，当前用户)
[System.Environment]::SetEnvironmentVariable("SILICON_API_KEY", "your_api_key_here", "User")

# Linux/Mac (临时)
export SILICON_API_KEY="your_api_key_here"

# Linux/Mac (永久)
echo 'export SILICON_API_KEY="your_api_key_here"' >> ~/.bashrc
source ~/.bashrc
```

**获取 API Key**：
1. 访问 https://siliconflow.cn
2. 注册并登录
3. 进入控制台获取 API Key
4. SiliconFlow 提供免费额度，适合个人使用

### 3. 备用金句

如果未配置API Key或API调用失败，系统会自动使用8条精选备用金句：

1. "我们无法选择生命中的卡牌，但可以决定如何出牌。" —— 兰迪·鲍许
2. "真正的知识不在于知道答案，而在于知道如何提出正确的问题。" —— 爱因斯坦
3. "在AI时代，无法被算法量化的'决策力'和'审美力'，才是人类最后的护城河。" —— 凯文·凯利
4. "复利的本质不是金钱，而是时间和认知的叠加效应。" —— 查理·芒格
5. "人类从历史中学到的唯一教训，就是人类无法从历史中学到任何教训。" —— 黑格尔
6. "最难的不是做出选择，而是为选择负责。" —— 让-保罗·萨特
7. "信息过载时代，稀缺的不是信息，而是注意力和判断力。" —— 赫伯特·西蒙
8. "优秀是一种习惯，卓越是一种选择。" —— 亚里士多德

## 📝 使用流程

### 1. 进入冥想模式
```
按快捷键 Ctrl+Shift+Space → 点击 "🧘 冥想" 标签
```

### 2. 查看金句
- 页面自动加载当前金句（首次为随机金句）
- 金句显示在中央大号文本框中
- 底部显示作者和分类

### 3. 导航金句
- **点击"← 上一条"**：浏览之前看过的金句
- **点击"下一条 →"**：浏览下一条金句，若已是最后一条则生成新的
- **点击"🎲 随机"**：调用AI生成全新金句（有加载提示）

### 4. 复制金句
- 点击 "📋 复制" 按钮
- 金句完整文本（含作者、分类）自动复制到剪贴板
- 按钮显示 "✓ 已复制" 2秒后恢复

### 5. 开始冥想计时
- 选择倒计时（45/15/10分钟或自定义）
- 或点击"正向计时"开始
- 计时器启动后，金句界面自动切换为计时器界面

### 6. 计时期间切换标签
- 计时器在后台继续运行
- 可切换到其他标签（Notion/Flomo/滴答清单）正常工作
- 切换回冥想标签，计时器正常显示

### 7. 停止计时
- 点击 "⏹ 停止" 结束计时
- 自动返回金句展示界面
- 可继续浏览或生成新金句

## 🎨 UI特点

### 1. **暗色AI主题**
- 深色背景：`#1a1a1a`
- 柔和强调色：`#5eb8d9` (青蓝色)
- 护眼配色，适合长时间使用

### 2. **金句展示**
- **字体大小**：24px（易读）
- **字重**：500（适中粗细）
- **行高**：1.8（舒适间距）
- **背景**：深色卡片 + 强调色边框
- **内边距**：40px 30px（宽松舒适）

### 3. **按钮样式**
- 统一高度：38px
- 宽度：100px
- 圆角：10px
- Hover效果：边框高亮 + 文字变色

### 4. **响应式提示**
- 点击"随机"时显示"正在生成金句..."
- 点击"复制"后显示"✓ 已复制"
- 2秒后自动恢复原状态

## 🔍 技术实现

### 1. **QuoteService 服务类**
```python
class QuoteService:
    - get_random_quote()      # 获取随机金句（AI或备用）
    - get_previous_quote()     # 获取上一条
    - get_next_quote()         # 获取下一条
    - get_current_quote()      # 获取当前金句
    - get_quote_text()         # 获取完整文本（用于复制）
```

### 2. **API调用流程**
```
用户点击"随机" 
  → 显示加载提示
  → 调用 SiliconFlow API
  → 解析JSON响应
  → 验证字段（quote, author, category）
  → 添加到历史记录
  → 更新UI显示
  
失败时：
  → 使用备用金句
  → 记录错误日志
  → 正常显示备用内容
```

### 3. **UI切换逻辑**
```python
def _switch_platform("meditation"):
    if 计时器运行中:
        显示计时器
        隐藏金句和选项
    else:
        显示金句和选项
        隐藏计时器和输入框
        加载当前金句
```

## 📊 数据流转

```
QuoteService 金句服务
    ↓
quotes_history (List[Dict])  # 历史记录
    ↓
current_index (int)  # 当前索引
    ↓
meditation_quote_label (QLabel)  # UI展示
    ↓
用户操作 (上一条/下一条/随机/复制)
    ↓
更新 current_index 或生成新金句
    ↓
刷新UI
```

## ⚠️ 注意事项

### 1. **API限制**
- SiliconFlow 免费版有请求频率限制
- 建议合理使用"随机"按钮，避免频繁请求
- 利用"上一条/下一条"浏览历史金句

### 2. **网络要求**
- AI金句生成需要网络连接
- 超时时间：30秒
- 无网络或超时时自动使用备用金句

### 3. **历史记录**
- 最多缓存100条金句
- 超过100条时自动删除最早的
- 重启应用后历史记录清空

### 4. **与计时器的关系**
- 金句展示和计时器是独立的两个界面
- 计时器运行时不显示金句
- 停止计时器后自动回到金句界面

## 🐛 故障排查

### 问题1：金句一直显示"正在加载..."
**可能原因**：
- API Key未配置或无效
- 网络连接问题
- API服务故障

**解决方案**：
1. 检查环境变量 `SILICON_API_KEY` 是否设置
2. 测试网络连接：`ping api.siliconflow.cn`
3. 查看日志文件确认错误信息
4. 系统会自动降级使用备用金句

### 问题2：点击"随机"没有反应
**可能原因**：
- UI线程阻塞
- API请求超时

**解决方案**：
1. 等待30秒（请求超时时间）
2. 重新点击"随机"按钮
3. 使用"上一条/下一条"浏览历史金句

### 问题3：复制按钮不工作
**可能原因**：
- 剪贴板权限问题
- 当前没有金句

**解决方案**：
1. 确保至少有一条金句在展示
2. 检查应用是否有剪贴板访问权限
3. 手动选中文本复制

## 📦 文件结构

```
项目根目录/
├── config.yaml                      # 金句配置（含AI prompt）
├── src/
│   ├── services/
│   │   └── quote_service.py        # 金句服务类
│   └── gui/
│       └── quick_input.py          # UI实现（含金句展示）
└── 冥想金句功能说明.md              # 本文档
```

## ✅ 测试检查清单

- [ ] 进入冥想标签，金句正常显示
- [ ] 不显示输入框，只显示金句和选项
- [ ] 点击"上一条"正常切换
- [ ] 点击"下一条"正常切换
- [ ] 点击"随机"生成新金句（有加载提示）
- [ ] 点击"复制"成功复制到剪贴板
- [ ] 选择倒计时，正常启动计时器
- [ ] 计时器运行时，金句界面隐藏
- [ ] 停止计时器，返回金句界面
- [ ] 切换到其他标签，金句界面隐藏
- [ ] 切换回冥想标签，金句界面正常显示

## 🎉 完成效果

- ✅ 冥想页面移除输入框
- ✅ 集成AI金句生成服务
- ✅ 美观的居中展示（带出处）
- ✅ 完整的导航功能（上一条、下一条、随机）
- ✅ 一键复制功能
- ✅ 与计时器无缝切换
- ✅ 优雅的加载提示
- ✅ 降级备用方案

冥想功能现已完整！🚀
