╔══════════════════════════════════════════════════════════════╗
║          QuickNote AI - 快捷键修复版测试指南                  ║
╚══════════════════════════════════════════════════════════════╝

【问题回顾】
  ❌ 旧版本：快捷键用1-2分钟后就失效
  ✅ 修复版：添加自动检测和重启机制

┌──────────────────────────────────────────────────────────────┐
│ 修复内容                                                      │
└──────────────────────────────────────────────────────────────┘

  1. ✅ 看门狗机制
     - 每10秒自动检查监听器是否存活
     - 如果发现停止，自动重启
     - 用户无感知

  2. ✅ 改进异常处理
     - 所有回调函数都有完整异常捕获
     - 异常不会导致监听线程崩溃
     - 详细的错误日志记录

  3. ✅ 独立线程执行回调
     - 快捷键回调在新线程中执行
     - 不会阻塞监听线程
     - 提高稳定性

┌──────────────────────────────────────────────────────────────┐
│ 测试步骤（重要！）                                             │
└──────────────────────────────────────────────────────────────┘

【步骤 1】启动程序（以管理员身份）

  1. 找到文件：dist\QuickNote_AI_Fixed\QuickNote_AI.exe
  2. 右键点击 → "以管理员身份运行"
  3. 等待托盘图标出现

【步骤 2】初始测试（0-1分钟）

  ⏰ 启动后立即测试：
  
  ✓ 按 Ctrl+Shift+Space
  ✓ 窗口是否弹出？
  ✓ 能否正常输入？
  ✓ 测试 3-5 次

【步骤 3】关键测试（1-3分钟）⭐

  ⏰ 等待 1 分钟后：
  
  ✓ 按 Ctrl+Shift+Space
  ✓ 快捷键是否仍然有效？
  
  ⏰ 等待 2 分钟后：
  
  ✓ 按 Ctrl+Shift+Space
  ✓ 快捷键是否仍然有效？
  
  ⏰ 等待 3 分钟后：
  
  ✓ 按 Ctrl+Shift+Space
  ✓ 快捷键是否仍然有效？

【步骤 4】长时间测试（5-10分钟）

  ⏰ 让程序在后台运行 5-10 分钟
  
  期间可以：
  - 切换到其他应用
  - 浏览网页
  - 编辑文档
  
  ⏰ 10 分钟后：
  
  ✓ 按 Ctrl+Shift+Space
  ✓ 快捷键是否仍然有效？
  
  ✅ 如果有效 → 修复成功！
  ❌ 如果无效 → 查看日志（下一步）

【步骤 5】查看日志

  打开 logs 目录，找到最新的日志文件
  
  搜索关键字：
  
  1. "看门狗已启动" → 确认看门狗运行
  2. "监听器已停止" → 是否有自动重启？
  3. "已重启" → 重启是否成功？
  4. "异常" → 是否有错误？

┌──────────────────────────────────────────────────────────────┐
│ 预期结果                                                      │
└──────────────────────────────────────────────────────────────┘

【完美情况】（最理想）
  ✅ 快捷键一直正常工作
  ✅ 日志中没有"已重启"
  ✅ 运行10分钟后仍然稳定

【良好情况】（可接受）
  ✅ 快捷键偶尔会失效
  ✅ 但 10 秒内自动恢复
  ✅ 日志中有"已重启"记录
  ✅ 用户基本无感知

【需要改进】（仍有问题）
  ❌ 快捷键频繁失效
  ❌ 自动重启也失败
  ❌ 日志中大量错误
  → 需要进一步诊断

┌──────────────────────────────────────────────────────────────┐
│ 日志示例                                                      │
└──────────────────────────────────────────────────────────────┘

【正常日志】
  [INFO] 快捷键监听器已初始化
  [INFO] 快捷键监听器已启动
  [INFO] 快捷键看门狗已启动
  [INFO] 触发快捷键: control+shift+space

【自动恢复日志】
  [WARNING] 检测到快捷键监听器已停止，正在重启...
  [INFO] 快捷键监听器已启动
  [INFO] 快捷键监听器已重启
  
  ↑ 这是正常的，说明看门狗在工作

【错误日志】
  [ERROR] 按键处理异常: ...
  [ERROR] 快捷键回调执行失败: ...
  
  ↑ 如果大量出现，需要反馈

┌──────────────────────────────────────────────────────────────┐
│ 对比测试（可选）                                               │
└──────────────────────────────────────────────────────────────┘

  可以同时运行旧版本和新版本对比：
  
  1. 旧版本：dist\QuickNote_AI\QuickNote_AI.exe
  2. 新版本：dist\QuickNote_AI_Fixed\QuickNote_AI.exe
  
  （注意：不要同时运行，会冲突！）
  
  对比要点：
  - 旧版本：1-2分钟后失效
  - 新版本：应该持续有效

┌──────────────────────────────────────────────────────────────┐
│ 如何反馈                                                      │
└──────────────────────────────────────────────────────────────┘

  请告诉我：
  
  1. 测试结果：
     - 运行多久后失效？（如果失效）
     - 是否有自动恢复？
  
  2. 日志内容：
     - 复制 logs 目录下最新日志的内容
     - 或截图关键部分
  
  3. 系统信息：
     - Windows 版本
     - 是否有其他快捷键工具
     - 是否有安全软件

┌──────────────────────────────────────────────────────────────┐
│ 快速诊断                                                      │
└──────────────────────────────────────────────────────────────┘

  如果快捷键失效：
  
  1. 检查托盘图标
     → 还在吗？（程序是否还在运行）
  
  2. 右键托盘图标 → "快速输入"
     → 能弹出窗口吗？（GUI 是否正常）
  
  3. 查看日志
     → 有"已重启"吗？（看门狗是否工作）
  
  4. 等待 10 秒后再测试
     → 恢复了吗？（自动重启是否成功）

╔══════════════════════════════════════════════════════════════╗
║                    开始测试吧！                               ║
╚══════════════════════════════════════════════════════════════╝

  文件位置：dist\QuickNote_AI_Fixed\QuickNote_AI.exe
  
  记得：
  1. ✅ 以管理员身份运行
  2. ✅ 至少测试 5-10 分钟
  3. ✅ 查看日志确认状态
  
  祝测试顺利！🎉

