# 冥想功能更新说明

## ✅ 已完成的修改

### 1. 新增"冥想"标签功能
- 在Tab栏添加"🧘 冥想"标签，位于"滴答清单"后面
- 点击切换至冥想模式

### 2. 冥想模式UI优化
**不再弹出新窗口，直接在输入框窗口内显示计时器**

#### 倒计时功能
- 提供4个快捷选项：
  - 45分钟
  - 15分钟
  - 10分钟
  - 自定义（弹出输入框设置1-999分钟）
- 点击后立即在当前窗口开始倒计时
- 倒计时结束自动停止

#### 正向计时功能
- 点击"开始"按钮后立即在当前窗口开始正向计时
- 可以无限计时

#### 计时器显示
- **超大号粗体字体**：90px Courier New字体
- **清晰显示**：HH:MM:SS格式（00:44:54）
- **精美边框**：带有青蓝色边框和圆角
- **控制按钮**：
  - ⏸ 暂停 / ▶ 继续
  - ⏹ 停止（返回冥想选项界面）

### 3. 窗口尺寸调整
- 窗口高度从560px增加到620px
- 为计时器显示提供足够空间

### 4. UI交互优化
- 切换到冥想标签时，显示选项区域和输入框
- 开始计时后：
  - 隐藏输入框
  - 隐藏选项区域
  - 显示计时器区域
- 停止计时后：
  - 恢复输入框和选项区域
  - 隐藏计时器区域

### 5. 其他优化
- 窗口显示优化：减少延迟调用，避免IME输入问题
- 快捷键监听器优化：放宽检测条件，减少误判和频繁重启
- 遮罩清理优化：改进移除逻辑，避免内存泄漏

## 📁 修改的文件

1. **src/gui/quick_input.py**
   - 移除 `MeditationTimerWindow` 弹窗类
   - 在 `QuickInputWindow` 内添加 `meditation_timer_widget`
   - 添加计时器相关方法：
     - `_start_meditation_timer()` - 开始计时
     - `_update_meditation_time()` - 更新时间
     - `_toggle_meditation_pause()` - 暂停/继续
     - `_stop_meditation()` - 停止计时
     - `_format_meditation_time()` - 格式化时间
   - 调整窗口高度为620px

2. **src/core/hotkey.py**
   - 优化看门狗检测逻辑
   - 放宽检测时间条件
   - 降低检查频率

## 🎯 使用方式

1. 按快捷键 `Ctrl+Shift+Space` 或点击托盘图标打开输入窗口
2. 点击"🧘 冥想"标签
3. 选择倒计时时长或点击"开始"正向计时
4. 计时器会直接在当前窗口显示，不会弹出新窗口
5. 可以随时暂停/继续或停止

## 📸 效果展示

### 冥想选项界面
```
┌──────────────────────────────────┐
│  📝 Notion  🏷️ Flomo  ✅ 滴答清单  🧘 冥想  │
├──────────────────────────────────┤
│  倒计时: [45分钟] [15分钟] [10分钟] [自定义]  │
│  正向计时: [开始]                    │
│                                  │
│  (输入框区域)                        │
└──────────────────────────────────┘
```

### 计时器显示界面
```
┌──────────────────────────────────┐
│  📝 Notion  🏷️ Flomo  ✅ 滴答清单  🧘 冥想  │
├──────────────────────────────────┤
│                                  │
│         🧘 倒计时                  │
│                                  │
│      ┌────────────────┐          │
│      │  00:44:54      │          │
│      └────────────────┘          │
│                                  │
│      [⏸ 暂停]  [⏹ 停止]          │
└──────────────────────────────────┘
```

## ✨ 技术特点

- **无弹窗设计**：所有功能在一个窗口内完成
- **平滑切换**：通过显示/隐藏控件实现模式切换
- **即时响应**：选择时间后立即开始，无需确认
- **视觉清晰**：超大号字体 + 等宽字体，方便查看
- **操作简便**：一键暂停/继续/停止

## 🐛 已解决的问题

1. ✅ 移除了独立的计时器弹窗
2. ✅ 计时器直接在输入框内显示
3. ✅ 窗口高度增加以容纳计时器
4. ✅ 修复遮罩卡顿和IME输入问题
5. ✅ 优化快捷键监听器频繁重启

## 📝 注意事项

- 计时器运行时，输入框会被隐藏
- 点击"停止"按钮会返回冥想选项界面
- 倒计时结束后会自动停止（可以点击"继续"重新开始）
- 正向计时可以无限计时，直到手动停止
